<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>範囲とモードの選択</title>
  <link rel="stylesheet" href="style.css">
  <script src="assets/data.js" defer></script>
</head>
<body>
  <main class="wrap">
    <a id="back" class="back" href="index.html">← TOPへ</a>
    <h1 id="subjectTitle">科目</h1>

    <section class="panel">
      <h2>授業回（シート）を選ぶ</h2>
      <select id="lessonSelect"></select>
      <small class="muted">※同一科目に複数のタブ/シートがある場合はここで選択</small>
    </section>

    <section class="panel">
      <h2>出題モード</h2>
      <label class="row"><input type="radio" name="mode" value="miss_unans" checked> 不正解＆未回答のみ</label>
      <label class="row"><input type="radio" name="mode" value="all"> 全問</label>
    </section>

    <div class="row end">
      <button id="start" class="primary">クイズ開始</button>
    </div>
  </main>

  <script>
    const qs = new URLSearchParams(location.search);
    const subject = qs.get('subject') || 'social';
    const titleMap = { math:'算数', kokugo:'国語', science:'理科', social:'社会' };
    document.getElementById('subjectTitle').textContent = `科目：${titleMap[subject] || subject}`;
    document.getElementById('back').href = `index.html`;

    const data = (window.DATA && window.DATA[subject]) || { lessons: [] };
    const sel = document.getElementById('lessonSelect');

    function renderLessons(){
      sel.innerHTML = '';
      data.lessons.forEach((l, i) => {
        const opt = document.createElement('option');
        opt.value = l.id;
        opt.textContent = l.title || l.id;
        sel.appendChild(opt);
      });
    }
    renderLessons();

    document.getElementById('start').addEventListener('click', () => {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const lesson = sel.value;
      const p = new URLSearchParams({ subject, mode, lesson });
      location.href = `quiz.html?${p.toString()}`;
    });
  </script>
</body>
</html>
