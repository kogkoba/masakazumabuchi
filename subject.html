<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>範囲とモードの選択</title>
  <link rel="stylesheet" href="style.css">
  <script src="assets/data.js" defer></script>
</head>
<body>
  <main class="wrap">
    <a class="back" href="index.html">← TOPへ</a>
    <h1 id="subjectTitle">科目</h1>

    <section class="panel">
      <h2>範囲を選ぶ</h2>
      <label class="row">
        <input type="radio" name="scope" value="all" checked> 全期間（その科目の全授業分）
      </label>
      <div class="row">
        <input type="radio" name="scope" value="lesson"> 授業回を選ぶ：
        <select id="lessonSelect" disabled></select>
      </div>
    </section>

    <section class="panel">
      <h2>出題モードを選ぶ</h2>
      <label class="row"><input type="radio" name="mode" value="miss_unans" checked> 不正解＆未回答</label>
      <label class="row"><input type="radio" name="mode" value="all"> 全問</label>
    </section>

    <div class="row end">
      <button id="start" class="primary">クイズ開始</button>
    </div>
  </main>

  <script>
    // 便利関数
    const qs = new URLSearchParams(location.search);
    const subject = qs.get('subject') || 'social';
    const titleMap = { math:'算数', kokugo:'国語', science:'理科', social:'社会' };
    document.getElementById('subjectTitle').textContent = `科目：${titleMap[subject] || subject}`;

    // DATA は assets/data.js で定義
    const entry = (window.DATA && window.DATA[subject]) || { lessons: [] };

    const scopeRadios = [...document.querySelectorAll('input[name="scope"]')];
    const lessonSel = document.getElementById('lessonSelect');

    // 授業回の選択肢生成
    function renderLessons() {
      lessonSel.innerHTML = '';
      entry.lessons.forEach(l => {
        const opt = document.createElement('option');
        opt.value = l.id;      // 例: "G4T3-nihon-no-kikou"
        opt.textContent = l.title; // 例: "小４(3) 日本の気候"
        lessonSel.appendChild(opt);
      });
    }
    renderLessons();

    // ラジオ連動
    scopeRadios.forEach(r => {
      r.addEventListener('change', () => {
        lessonSel.disabled = (document.querySelector('input[name="scope"]:checked').value !== 'lesson');
      });
    });

    // 開始
    document.getElementById('start').addEventListener('click', () => {
      const scope = document.querySelector('input[name="scope"]:checked').value;
      const mode  = document.querySelector('input[name="mode"]:checked').value;
      const params = new URLSearchParams();
      params.set('subject', subject);
      params.set('mode', mode);
      if (scope === 'lesson') params.set('lesson', lessonSel.value);
      else params.set('lesson', 'all');
      location.href = `quiz.html?${params.toString()}`;
    });
  </script>
</body>
</html>
